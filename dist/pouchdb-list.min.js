!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.List=t()}}(function(){var define,module,exports;return function t(e,r,n){function o(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return o(r?r:t)},c,c.exports,t,e,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,r){"use strict";function n(t,e,r,n,a){var u=t.get("_design/"+e).then(function(t){if(!(t.lists||{}).hasOwnProperty(r))throw new s({status:404,name:"not_found",message:"missing list function "+r+" on design doc _design/"+e});return t}),c=o({},a.query),p=t.query(e+"/"+n,c),l=[];return p.then(function(e){return l.push(e),t.info()}).then(function(t){return l.push(t),u}).then(function(t){return l.push(t),l}).then(Function.prototype.apply.bind(function(t,e,n){var s,a={offset:t.offset,total_rows:t.total_rows,update_seq:e.update_seq},u=[],c={getRow:function(){return t.rows.shift()||null},send:function(t){c.start({}),u.push(t)},start:function(t){s||(s=t)}},p={headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"},query:{}},l=i(n.lists[r],n,a,p,c);return s&&(o(l,s),l.body=u.join("")+l.body,l.headers["Transfer-Encoding"]="chunked"),l},null))}var o=t("extend"),i=t("couchdb-render"),s=t("pouchdb-plugin-error");r.list=function(t,e,r){var o=this;-1!==["function","undefined"].indexOf(typeof e)&&(r=e,e={});var i=t.split("/")[0],s=t.split("/")[1],a=t.split("/")[2],u=["_design",i,"_list",s];return a&&u.push(a),-1===["http","https"].indexOf(o.type())?n(o,i,s,a,e):o.request({method:"GET",url:u.join("/")})}},{"couchdb-render":2,extend:6,"pouchdb-plugin-error":7}],2:[function(t,e,r){"use strict";function n(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(){function t(t){var e=Array.prototype.slice.call(arguments,1);f.push([t,e])}function e(t){try{return l[t]()}catch(e){throw u.wrapExecutionError(e)}}function r(){return f.filter(function(t){return l.hasOwnProperty(t[0])})}function n(t){for(var e=0;e<f.length;e+=1)if(f[e][0]===t)return f[e][1][0]}function o(t){for(var e=i(t),o=r(),s=0;s<e.length;s+=1)for(var a=e[s],u=a.split(";")[0].trim().split("/"),c=0;c<o.length;c+=1)for(var f=o[c][0],d=o[c][1],y=0;y<d.length;y+=1){var h=d[y],m=h.split(";")[0].trim().split("/"),g=!(u[0]!==m[0]&&"*"!==u[0]&&"*"!==m[0]||u[1]!==m[1]&&"*"!==u[1]&&"*"!==m[1]);if(g)return[f,h]}throw new p({status:406,name:"not_acceptable",message:["Content-Type(s)",e.join(", "),"not supported, try one of:",Object.keys(l).map(n)].join(" ")})}function s(t,e){l[t]=e}function c(t){if(a(l))return[""];if(t.query.format){if(!l.hasOwnProperty(t.query.format))throw new p({status:500,name:"render_error",message:["the format option is set to '",t.query.format,"', but there's no provider registered for that format."].join("")});return[e(t.query.format),n(t.query.format)]}var r=o(t.headers.Accept);return[e(r[0]),r[1]]}var l={},f=[];return t("all","*/*"),t("text","text/plain; charset=utf-8","txt"),t("html","text/html; charset=utf-8"),t("xhtml","application/xhtml+xml","xhtml"),t("xml","application/xml","text/xml","application/x-xml"),t("js","text/javascript","application/javascript","application/x-javascript"),t("css","text/css"),t("ics","text/calendar"),t("csv","text/csv"),t("rss","application/rss+xml"),t("atom","application/atom+xml"),t("yaml","application/x-yaml","text/yaml"),t("multipart_form","multipart/form-data"),t("url_encoded_form","application/x-www-form-urlencoded"),t("json","application/json","text/x-json"),{api:{provides:s,registerType:t},getResult:c}}function i(t){return t.split(",").map(function(t){return t.split(";")[0].trim()})}var s=t("extend"),a=t("is-empty"),u=t("couchdb-eval"),c=t("couchdb-resp-completer"),p=t("pouchdb-plugin-error");e.exports=function(t,e,r,i,a){a||(a={});var p=o();s(a,p.api);var l,f,d=u.evaluate(e,a,t);try{l=d.call(e,r,i)}catch(y){throw u.wrapExecutionError(y)}if("string"!=typeof l&&!n(l)){var h=p.getResult(i);l=h[0],f=h[1]}return c(l,f)}},{"couchdb-eval":3,"couchdb-resp-completer":4,extend:6,"is-empty":5,"pouchdb-plugin-error":7}],3:[function(_dereq_,module,exports){"use strict";function evalProgram(program,locals){var keys=Object.keys(locals),values=keys.map(function(t){return locals[t]}),code="(function ("+keys.join(", ")+") {"+program+"})";return eval(code).apply(null,values)}var PouchPluginError=_dereq_("pouchdb-plugin-error"),extend=_dereq_("extend");exports.evaluate=function(t,e,r){var n;t&&(n=function(e){var r=extend({module:{id:e,current:void 0,parent:void 0,exports:{}}},i);r.exports=r.module.exports;for(var n=e.split("/"),o=t,s=0;s<n.length;s+=1)o=o[n[s]];return o+="\nreturn module.exports;",evalProgram(o,r)}),r=r.replace(/;\s*$/,"");var o,i=extend({isArray:isArray,toJSON:toJSON,log:log,sum:sum,require:n},e);try{if(o=evalProgram("return "+r,i),"function"!=typeof o)throw"no function"}catch(s){throw new PouchPluginError({name:"compilation_error",status:500,message:"Expression does not eval to a function. "+r})}return o};var isArray=Array.isArray,toJSON=JSON.stringify,log=function(t){"string"!=typeof t&&(t=JSON.stringify(t)),console.log("EVALUATED FUNCTION LOGS: "+t)},sum=function(t){return t.reduce(function(t,e){return t+e})};exports.wrapExecutionError=function(t){return new PouchPluginError({name:t.name,message:t.toString()+"\n\n"+t.stack,status:500})}},{extend:6,"pouchdb-plugin-error":7}],4:[function(t,e,r){"use strict";var n=t("extend"),o=t("is-empty"),i=t("pouchdb-plugin-error");e.exports=function(t,e){"string"==typeof t&&(t={body:t}),"[object Object]"!==Object.prototype.toString.call(t)&&(t={});var r=n({},t);if(delete r.code,delete r.json,delete r.body,delete r.base64,delete r.headers,delete r.stop,!o(r)){var s=Object.keys(r)[0];throw new i({status:500,name:"external_response_error",message:["Invalid data from external server: {<<",JSON.stringify(s),">>,<<",JSON.stringify(r[s]),">>}"].join("")})}return t.code=t.code||200,t.headers=t.headers||{},t.headers.Vary=t.headers.Vary||"Accept",t.headers["Content-Type"]=t.headers["Content-Type"]||e,"undefined"!=typeof t.json&&(t.body=JSON.stringify(t.json),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),"undefined"!=typeof t.base64&&(t.headers["Content-Type"]=t.headers["Content-Type"]||"application/binary"),t.headers["Content-Type"]=t.headers["Content-Type"]||"text/html; charset=utf-8",delete t.headers.Etag,"undefined"==typeof t.body&&"undefined"==typeof t.base64&&(t.body=""),t}},{extend:6,"is-empty":5,"pouchdb-plugin-error":7}],5:[function(t,e,r){function n(t){if(null==t)return!0;if("number"==typeof t)return 0===t;if(void 0!==t.length)return 0===t.length;for(var e in t)if(o.call(t,e))return!1;return!0}e.exports=n;var o=Object.prototype.hasOwnProperty},{}],6:[function(t,e,r){var n,o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,s=function(t){"use strict";if(!t||"[object Object]"!==i.call(t)||t.nodeType||t.setInterval)return!1;var e=o.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&o.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!r)return!1;var s;for(s in t);return s===n||o.call(t,s)};e.exports=function a(){"use strict";var t,e,r,o,i,u,c=arguments[0],p=1,l=arguments.length,f=!1;for("boolean"==typeof c?(f=c,c=arguments[1]||{},p=2):("object"!=typeof c&&"function"!=typeof c||c==n)&&(c={});l>p;++p)if(null!=(t=arguments[p]))for(e in t)r=c[e],o=t[e],c!==o&&(f&&o&&(s(o)||(i=Array.isArray(o)))?(i?(i=!1,u=r&&Array.isArray(r)?r:[]):u=r&&s(r)?r:{},c[e]=a(f,u,o)):o!==n&&(c[e]=o));return c}},{}],7:[function(t,e,r){"use strict";function n(t){this.status=t.status,this.name=t.name,this.message=t.message,this.error=!0,this.stack=(new Error).stack}n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},e.exports=n},{}]},{},[1])(1)});
