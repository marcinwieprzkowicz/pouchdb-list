!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.List=t()}}(function(){var define,module,exports;return function t(r,e,n){function o(i,s){if(!e[i]){if(!r[i]){var a="function"==typeof require&&require;if(!s&&a)return a(i,!0);if(u)return u(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=e[i]={exports:{}};r[i][0].call(c.exports,function(t){var e=r[i][1][t];return o(e?e:t)},c,c.exports,t,r,e,n)}return e[i].exports}for(var u="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,r,e){"use strict";function n(t,r,e,n,s){var a=t.get("_design/"+r).then(function(t){if(!(t.lists||{}).hasOwnProperty(e))throw new i({status:404,name:"not_found",message:"missing list function "+e+" on design doc _design/"+r});return t}),c=o({},s.query),f=t.query(r+"/"+n,c),l=[];return f.then(function(r){return l.push(r),t.info()}).then(function(t){return l.push(t),a}).then(function(t){return l.push(t),l}).then(Function.prototype.apply.bind(function(t,r,n){var o,i,s=[],a=t.rows,c={getRow:function(){return a.shift()||null},send:function(t){c.start({}),s.push(t)},start:function(t){o||(o=t)}},f=u.evaluate(n,c,n.lists[e]);try{i=f.call(n)}catch(l){throw u.wrapExecutionError(l)}return JSON.parse(i)},null))}var o=t("extend"),u=t("couchdb-eval"),i=t("pouchdb-plugin-error");e.list=function(t,r,e){var o=this;-1!==["function","undefined"].indexOf(typeof r)&&(e=r,r={});var u=t.split("/")[0],i=t.split("/")[1],s=t.split("/")[2],a=["_design",u,"_list",i];return s&&a.push(s),-1===["http","https"].indexOf(o.type())?n(o,u,i,s,r):o.request({method:"GET",url:a.join("/")})}},{"couchdb-eval":2,extend:3,"pouchdb-plugin-error":4}],2:[function(_dereq_,module,exports){"use strict";function evalProgram(program,locals){var keys=Object.keys(locals),values=keys.map(function(t){return locals[t]}),code="(function ("+keys.join(", ")+") {"+program+"})";return eval(code).apply(null,values)}var PouchPluginError=_dereq_("pouchdb-plugin-error"),extend=_dereq_("extend");exports.evaluate=function(t,r,e){var n;t&&(n=function(r){var e=extend({module:{id:r,current:void 0,parent:void 0,exports:{}}},u);e.exports=e.module.exports;for(var n=r.split("/"),o=t,i=0;i<n.length;i+=1)o=o[n[i]];return o+="\nreturn module.exports;",evalProgram(o,e)}),e=e.replace(/;\s*$/,"");var o,u=extend({isArray:isArray,toJSON:toJSON,log:log,sum:sum,require:n},r);try{if(o=evalProgram("return "+e,u),"function"!=typeof o)throw"no function"}catch(i){throw new PouchPluginError({name:"compilation_error",status:500,message:"Expression does not eval to a function. "+e})}return o};var isArray=Array.isArray,toJSON=JSON.stringify,log=function(t){"string"!=typeof t&&(t=JSON.stringify(t)),console.log("EVALUATED FUNCTION LOGS: "+t)},sum=function(t){return t.reduce(function(t,r){return t+r})};exports.wrapExecutionError=function(t){return new PouchPluginError({name:t.name,message:t.toString()+"\n\n"+t.stack,status:500})}},{extend:3,"pouchdb-plugin-error":4}],3:[function(t,r,e){var n,o=Object.prototype.hasOwnProperty,u=Object.prototype.toString,i=function(t){"use strict";if(!t||"[object Object]"!==u.call(t)||t.nodeType||t.setInterval)return!1;var r=o.call(t,"constructor"),e=t.constructor&&t.constructor.prototype&&o.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!e)return!1;var i;for(i in t);return i===n||o.call(t,i)};r.exports=function s(){"use strict";var t,r,e,o,u,a,c=arguments[0],f=1,l=arguments.length,p=!1;for("boolean"==typeof c?(p=c,c=arguments[1]||{},f=2):("object"!=typeof c&&"function"!=typeof c||c==n)&&(c={});l>f;++f)if(null!=(t=arguments[f]))for(r in t)e=c[r],o=t[r],c!==o&&(p&&o&&(i(o)||(u=Array.isArray(o)))?(u?(u=!1,a=e&&Array.isArray(e)?e:[]):a=e&&i(e)?e:{},c[r]=s(p,a,o)):o!==n&&(c[r]=o));return c}},{}],4:[function(t,r,e){"use strict";function n(t){this.status=t.status,this.name=t.name,this.message=t.message,this.error=!0,this.stack=(new Error).stack}n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},r.exports=n},{}]},{},[1])(1)});
